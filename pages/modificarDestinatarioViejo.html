<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-
scale=1.0">

    <title>Modificar Destinatario</title>
    <link rel="stylesheet" href="./static/css/estilos.css">
</head>

<body>
    <header>
        <nav class="navbar-index ">

    </header>
    <h1>Modificar Destinatario</h1><br>
    <!-- Contenedor principal que será controlado por JavaScript. Este
contenedor tendrá dos formularios. -->
    <div id="app">
        <!-- Primer formulario: Selector de producto. LLama a la función
obtenerProducto cuando se envíe el formulario -->
        <form id="form-obtener-destinatario">
            <label for="idDestinatario">Código:</label>
            <input type="number" id="idDestinatario" readonly="true"><br>
            <a href="inicio.html">Inicio</a>
        </form>
        <!-- Segundo formulario: se muestra solo si mostrarDatosProducto
es verdadero. Llama a la función guardarCambios -->
        <div id="datos-destinatario">
            <h2>Datos del Destinatario</h2>
            <form id="form-guardar-cambios">
                <label for="descripcionModificar">Nombre/Descripción:</label>
                <input type="text" id="descripcionModificar" required><br>

                <label for="cbuModificar">CBU:</label>
                <input type="number" id="cbuModificar" required><br>
                <label for="aliasModificar">Alias:</label>
                <input type="text" id="aliasModificar" required><br>
                <button type="submit" id="guardarCambios">Guardar Cambios</button>
                <a href="modificaciones.html">Cancelar</a>
            </form>
        </div>
    </div>
    <script>
        const URL = "http://127.0.0.1:5000/"
        // Al subir al servidor, deberá utilizarse la siguiente ruta.
        //USUARIO debe ser reemplazado por el nombre de usuario de Pythonanywhere
        //const URL = "https://USUARIO.pythonanywhere.com/"
        // Variables de estado para controlar la visibilidad y los datos del formulario
//punto 1
        window.addEventListener("DOMContentLoaded", function() {
            const urlParams = new URLSearchParams(window.location.search);

// Obtén el valor del parámetro 'name'
            const idDestinatario = urlParams.get('idDestinatario');
            let campoIdDestinatario=document.getElementById('idDestinatario');
            campoIdDestinatario.value=idDestinatario;
            campoIdDestinatario.readonly=true;
        })
//borrar
        let descripcion = '';
        let cbu = '';
        let alias = '';
        let mostrarDatosDestinatario = false;

       //document.getElementById('form-obtener-destinatario').addEventListener('submit', obtenerDestinatario);

        document.getElementById('form-guardar-cambios').addEventListener('submit', guardarCambios);


        document.getElementById('guardarCambios').addEventListener("click", function() {
            guardarCambios()
        })
//ver register js 
//var formData incluido fetch
/*
            var formData = new FormData(this);
    
            // Realizamos la solicitud POST al servidor
            fetch(URL + 'clientes', {
                method: 'POST',
                body: formData // Aquí enviamos formData. Dado que formData puede contener archivos, no se utiliza JSON.*/
        // Se ejecuta cuando se envía el formulario de consulta. Realiza una solicitud GET a la API y obtiene los datos del producto correspondiente al código ingresado.
        /*
        function obtenerDestinatario(event) {
            event.preventDefault();
            idDestinatario = ParseInt(document.getElementById('idDestinatario').value);
            fetch(URL + 'destinatarios/' + idDestinatario)
                .then(response => {
                    if (response.ok) 
                    window.location=transfer.html {
                        return response.json()
                    } else {
                        throw new Error('Error al obtener los datos de los destinatarios.')
                    }
                })
                .then(data => {
                    descripcion = data.descripcion;
                    cbu = data.cbu;
                    alias = data.alias;
                    mostrarDatosProducto = true; //Activa la vista del segundo formulario

                    mostrarFormulario();
                })
                .catch(error => {
                    alert('Código no encontrado.');
                });
        }*/
        // Muestra el formulario con los datos del producto
        function mostrarFormulario() {
            if (mostrarDatosDestinatario) {
                document.getElementById('descripcionModificar').value =
                descripcion;

                document.getElementById('cbuModificar').value = cbu;

                document.getElementById('aliasModificar').value = alias;
            }
        }
            //Al subir al servidor, deberá utilizarse la siguiente ruta.USUARIO debe ser reemplazado por el nombre de usuario de Pythonanywhere

            // Se usa para enviar los datos modificados del producto al servidor.
            function guardarCambios(formulario) {
                let idDestinatario=document.getElementById('idDestinatario').value;
                let descripcion=document.getElementById('descripcion').value;
                let cbu=document.getElementById('cbu').value;
                let alias=document.getElementById('alias').value;

                const params = new FormData();
                params.append('idDestinatario', idDestinatario);
                params.append('descripcion', descripcion);
                params.append('cbu', cbu);
                params.append('alias', alias);
/*
                const formData = new FormData();
                formData.append('idDestinatario', idDestinatario);
                formData.append('descripcion', document.getElementById('descripcionModificar').value);
                formData.append('cbu', document.getElementById('cbuModificar').value);
                formData.append('alias', document.getElementById('aliasModificar').value);
                */
                
            fetch(URL + 'destinatarios/' + idDestinatario, {
                method: 'PUT',
                body: params,
            })
                .then(response => {
                    if (response.ok) {
                        return response.json()
                    } else {
                        throw new Error('Error al guardar los cambios del destinatario.')
                    }
                })
                .then(data => {
                    alert('Destinatario actualizado correctamente.');
                    limpiarFormulario();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al actualizar el destinatario.');
                });
            }
        
        // Restablece todas las variables relacionadas con el formulario a sus valores iniciales, lo que efectivamente "limpia" el formulario.
        function limpiarFormulario() {
            document.getElementById('idDestinatario').value = '';
            document.getElementById('descripcionModificar').value = '';
            document.getElementById('cbuModificar').value = '';
            document.getElementById('aliasModificar').value = '';

            idDestinatario = '';
            descripcion = '';
            cbu = '';
            alias = '';
            mostrarDatosDestinatario = false;
            document.getElementById('datos-destinatario').style.display =

                'none';
        }
    </script>

</body>

</html>