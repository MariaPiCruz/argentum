<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Argentum-Registro</title>
    <link rel="stylesheet" href="../static/css/loguin.css">
    <script
      src="https://kit.fontawesome.com/2f8ba933a8.js"
      crossorigin="anonymous"
    ></script>
</head>
<body>
    
    <div class="form-container">
        <h1>Registrate</h1>
        <div class="links">
            <a href="loguin.html">Inicio de Sesión</a>
            <a href="#" class="active">Registro</a>
        </div>
        <form action="" method="post" autocomplete="off" class="register" id="formulario">
            <div class="form-item">
                <label for="username">
                    <i class="fas fa-user"></i>
                </label>
            <input type="text" name="username" placeholder="Usuario" id="username" required>
            </div>
            <div class="form-item">
                <label for="password">
                    <i class="fas fa-lock"></i>
                </label>
                <input type="password" name="password" placeholder="Contraseña" id="password" required>
            </div>
            <div class="form-item">
                <label for="email">
                    <i class="fas fa-envelope"></i>
                </label>
                <input type="email" name="email" placeholder="Email" id="email" required>
            </div>
            <div class="msg"></div>
            <input type="submit" value="Registrarse">
        </form>
    </div>

    <script>
        const URL = "http://127.0.0.1:5000/";
        

        // Capturamos el evento de envío del formulario
        document.getElementById('formulario').addEventListener('submit', function (event) {
            event.preventDefault(); // Evitamos que se envie el form 

            var formData = new FormData(this);
    
            // Realizamos la solicitud POST al servidor
            fetch(URL + 'accounts', {
                method: 'POST',
                body: formData // Aquí enviamos formData. Dado que formData puede contener archivos, no se utiliza JSON.
            })

            //Después de realizar la solicitud POST, se utiliza el método then() para manejar la respuesta del servidor.
            .then(function (response) {
                    if (response.ok) { 
                        //Si la respuesta es exitosa, convierte los datos de la respuesta a formato JSON.
                        return response.json(); 
                    } else {
                        // Si hubo un error, lanzar explícitamente una excepción
                        // para ser "catcheada" más adelante
                        throw new Error('Error al crear cuenta.');
                    }
            })

                //Respuesta OK, muestra una alerta informando que el producto se agregó correctamente y limpia los campos del formulario para que puedan ser utilizados para un nuevo producto.
                .then(function (data) {
                    alert('Cuenta creada correctamente.');
                })

                // En caso de error, mostramos una alerta con un mensaje de error.
                .catch(function (error) {
                    alert('Error al crear la cuenta.');
                })

                // Limpiar el formulario en ambos casos (éxito o error)
                .finally(function () {
                    document.getElementById('username').value = "";
                    document.getElementById('password').value = "";
                    document.getElementById('email').value = "";
                });
        })
    </script>
</body>
</html>

